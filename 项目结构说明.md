# 自动答题系统 - 项目结构说明

## 目录结构

```
DoubaoFreeApi/
├── src/
│   └── auto_answer/              # 自动答题系统模块
│       ├── models/               # 数据模型
│       │   └── config.py         # 配置数据类（Region, Coordinate, AnswerConfig）
│       ├── services/             # 服务层
│       │   ├── screen_capture.py # 屏幕截图服务
│       │   ├── ocr_service.py    # OCR识别服务
│       │   ├── ai_service.py     # AI答题服务
│       │   └── auto_click.py     # 自动点击服务
│       ├── core/                 # 核心逻辑
│       │   ├── config_manager.py # 配置管理器
│       │   └── controller.py     # 答题控制器
│       └── gui/                  # 图形界面
│           ├── main_window.py    # 主窗口
│           ├── region_selector.py # 区域选择器
│           └── option_configurator.py # 选项配置器
├── auto_answer_main.py           # 启动入口
├── auto_answer_config.json       # 配置文件（自动生成）
├── logs/                         # 日志目录
├── README_AUTO_ANSWER.md         # 使用文档
└── 快速开始.md                   # 快速开始指南
```

## 模块说明

### 1. 数据模型层 (models/)

**config.py** - 定义数据结构
- `Region`: 屏幕区域（x, y, width, height）
- `Coordinate`: 坐标点（x, y）
- `AnswerConfig`: 答题配置（题目区域、选项坐标、下一题按钮）

### 2. 服务层 (services/)

**screen_capture.py** - 屏幕截图
- 使用PIL.ImageGrab截取指定区域
- 返回PIL Image对象

**ocr_service.py** - OCR识别
- 使用pytesseract识别图像中的文字
- 支持中英文识别
- 图像预处理提高识别率

**ai_service.py** - AI答题
- 调用豆包API获取答案
- 解析AI返回的答案选项
- 实现重试机制

**auto_click.py** - 自动点击
- 使用pyautogui模拟鼠标点击
- 支持平滑移动和点击

### 3. 核心逻辑层 (core/)

**config_manager.py** - 配置管理
- 加载和保存配置文件
- 提供配置设置方法

**controller.py** - 答题控制器
- 协调各服务完成答题流程
- 实现答题循环逻辑
- 处理错误和异常

### 4. 图形界面层 (gui/)

**main_window.py** - 主窗口
- 使用Tkinter创建GUI
- 提供配置和控制按钮
- 显示进度和日志

**region_selector.py** - 区域选择器
- 全屏半透明覆盖层
- 鼠标拖动选择区域
- 返回选择的坐标

**option_configurator.py** - 选项配置器
- 引导用户配置各个选项
- 依次配置A/B/C/D和下一题按钮

### 5. 启动入口

**auto_answer_main.py** - 主程序
- 初始化所有组件
- 连接GUI和控制器
- 处理用户操作

## 工作流程

```
用户操作
  ↓
主窗口 (MainWindow)
  ↓
答题控制器 (AnswerController)
  ↓
服务层 (Services)
  ├─ 屏幕截图 → OCR识别 → AI答题 → 自动点击
  └─ 配置管理
```

## 数据流

```
1. 用户配置
   GUI → ConfigManager → config.json

2. 答题流程
   Controller → ScreenCapture → Image
              → OCRService → Text
              → AIService → Answer
              → AutoClick → 完成

3. 状态更新
   Controller → GUI (进度、状态、日志)
```

## 关键技术

- **GUI**: Tkinter（Python标准库）
- **截图**: PIL/Pillow
- **OCR**: pytesseract + Tesseract-OCR
- **自动化**: pyautogui
- **异步**: asyncio
- **日志**: loguru
- **HTTP**: aiohttp

## 扩展建议

如果你想扩展功能，可以：

1. **支持更多题型**
   - 修改 `ai_service.py` 的答案解析逻辑
   - 添加新的选项配置

2. **提高识别准确率**
   - 优化 `ocr_service.py` 的图像预处理
   - 调整OCR参数

3. **添加答题策略**
   - 在 `controller.py` 中添加答题逻辑
   - 支持跳过、标记等功能

4. **改进用户界面**
   - 美化 `main_window.py` 的界面
   - 添加更多配置选项

## 代码风格

- 遵循PEP 8规范
- 使用类型提示
- 详细的文档字符串
- 完善的错误处理
- 清晰的日志记录

## 学习路径

1. 先看 `auto_answer_main.py` 了解整体结构
2. 再看 `controller.py` 了解答题流程
3. 然后看各个服务层了解具体实现
4. 最后看GUI层了解界面交互

祝你学习愉快！🎓
