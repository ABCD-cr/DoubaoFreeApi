# 自动答题系统使用说明

## ✅ 修复完成

系统已经修复了"AI返回空响应"的问题。现在可以正确处理豆包API的频率限制。

## 🚀 如何使用

### 1. 启动系统

双击运行：`启动自动答题.bat`

或者在命令行运行：
```bash
cd DoubaoFreeApi
python auto_answer_main.py
```

### 2. 配置区域

首次使用需要配置：
- **题目区域**：框选题目显示的区域
- **选项坐标**：点击A、B、C、D选项的位置
- **下一题按钮**：点击"下一题"按钮的位置

配置会自动保存到 `auto_answer_config.json`

### 3. 启动答题

1. 点击"启动API服务"按钮（等待3-5秒直到显示"API运行中"）
2. 输入题目总数
3. （可选）勾选"深度思考"用于难题
4. 点击"开始答题"

### 4. 监控进度

- **进度条**：显示当前进度
- **日志窗口**：显示详细的答题过程
- **状态栏**：显示当前状态

## ⚠️ 关于频率限制

### 什么是频率限制？

豆包API为了保护服务器，会限制单个账号的请求频率。当短时间内请求过多时，会返回错误：

```
错误代码: 710022004
错误信息: rate limited
```

### 系统如何处理？

系统已经内置了智能处理机制：

1. **基础延迟**：每题之间自动等待5秒
2. **智能检测**：检测到限制后自动等待10秒
3. **继续答题**：等待后自动继续处理下一题

你会在日志中看到：
```
检测到频率限制，等待10秒后继续...
```

### 如何避免频率限制？

#### 方法1：分批答题（推荐）

如果题目很多（超过50题），建议分批进行：
- 第1批：1-30题
- 休息2-3分钟
- 第2批：31-60题
- 休息2-3分钟
- 第3批：61-90题

#### 方法2：增加延迟时间

如果仍然频繁遇到限制，可以修改延迟时间：

1. 打开文件：`DoubaoFreeApi/src/auto_answer/core/controller.py`
2. 找到这一行（约第130行）：
   ```python
   await asyncio.sleep(5.0)
   ```
3. 改为更长时间：
   ```python
   await asyncio.sleep(8.0)  # 改为8秒
   ```
4. 保存文件，重启程序

#### 方法3：使用深度思考模式

勾选"深度思考"选项，AI会花更多时间思考，自然降低请求频率。

### 频率限制多久恢复？

根据测试，频率限制通常在 **5-10分钟** 后自动恢复。如果遇到限制：

1. 点击"停止答题"
2. 等待5-10分钟
3. 重新开始答题

## 📊 推荐配置

### 少量题目（1-30题）
- 基础延迟：5秒（默认）
- 深度思考：关闭
- 预计时间：约3-5分钟

### 中等题目（31-60题）
- 基础延迟：5秒（默认）
- 深度思考：关闭
- 分批建议：分2批，每批30题
- 预计时间：约8-12分钟

### 大量题目（61-100题）
- 基础延迟：8秒（建议修改）
- 深度思考：关闭
- 分批建议：分3批，每批30-35题
- 预计时间：约20-30分钟

## 🔧 故障排除

### 问题1：API启动失败

**现象**：点击"启动API服务"后显示"API启动失败"

**解决方案**：
1. 检查端口8000是否被占用：
   ```bash
   netstat -ano | findstr :8000
   ```
2. 如果被占用，结束进程：
   ```bash
   taskkill /F /PID [进程ID]
   ```
3. 重新点击"启动API服务"

### 问题2：一直显示"AI返回空响应"

**现象**：日志中持续显示"AI请求失败：AI返回空响应"

**原因**：触发了频率限制

**解决方案**：
1. 点击"停止答题"
2. 等待5-10分钟
3. 重新开始答题
4. 考虑增加延迟时间或分批答题

### 问题3：点击位置不准确

**现象**：系统点击的位置不是选项或按钮

**解决方案**：
1. 点击"配置选项坐标"重新配置
2. 确保答题界面位置固定，不要移动窗口
3. 确保屏幕缩放比例为100%

### 问题4：识别错误

**现象**：AI识别的答案不正确

**解决方案**：
1. 检查题目区域是否完整包含题目和选项
2. 尝试勾选"深度思考"选项
3. 确保截图清晰，没有遮挡

## 📝 日志说明

系统会自动保存日志到 `logs/` 目录，文件名格式：
```
auto_answer_YYYY-MM-DD_HH-MM-SS.log
```

如果遇到问题，可以查看日志文件获取详细信息。

## 🎯 最佳实践

1. **首次使用**：先用5-10题测试，确保配置正确
2. **大量题目**：分批进行，每批30题左右
3. **监控日志**：注意查看是否有频率限制提示
4. **保持稳定**：答题过程中不要移动窗口或切换屏幕
5. **合理延迟**：不要将延迟设置太短（建议5-8秒）

## 📞 技术支持

如果遇到其他问题，请查看：
- `频率限制说明.md` - 详细的频率限制说明
- `问题修复-频率限制.md` - 技术细节和修复说明
- `logs/` 目录 - 查看详细日志

---

**版本**: v1.1  
**更新日期**: 2026-01-30  
**主要改进**: 修复频率限制处理，增加智能等待机制
